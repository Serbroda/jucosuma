{{ define "title" }}{{ if .Contract.ID }}Edit Contract{{ else }}Add Contract{{ end }}{{ end }}

{{ define "main" }}

<dialog id="my_modal_1" class="modal">
    <div class="modal-box">
        <h3 class="text-lg font-bold pb-2">Icon Search</h3>
        <div class="flex gap-2">
            <input
                    type="search"
                    name="term"
                    class="input flex-1 w-full"
                    placeholder="Type here"
            />
            <button
                    type="button"
                    class="btn btn-square"
                    hx-get="/api/icons"
                    hx-include="[name=term]"
                    hx-target="#icon-results"
                    hx-swap="innerHTML"
            >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"/>
                </svg>
            </button>
        </div>
        <div id="icon-results" class="flex flex-wrap gap-2 pt-4">
            {{ template "icon-results" . }}
        </div>
        <input type="hidden" id="selected-icon-url" name="icon_source" />
        <div class="modal-action">
            <button id="apply-icon" class="btn btn-primary">Apply</button>
            <button class="btn" type="button" onclick="my_modal_1.close()">Close</button>
        </div>
    </div>
</dialog>

<h1 class="text-3xl">
    {{ if .Contract.ID }}Edit Contract{{ else }}Add Contract{{ end }}
</h1>
<h2 class="text-lg py-4">Contract Details</h2>

<form id="contract-form" class="list bg-base-100 rounded-box shadow-md p-4"
    hx-{{ .FormMethod }}="{{ .FormAction }}"
    hx-include="#contract-form"
    hx-swap="none"
>
<div class="grid grid-cols-1 gap-4 lg:grid-cols-2">
    <div class="lg:col-span-2">
        <button type="button" onclick="my_modal_1.showModal()">
            <img id="main-icon" class="w-12 h-12 rounded-box border border-gray-400 dark:border-gray-600 hover:cursor-pointer" alt="Logo"
                 src="{{ if .Contract.IconSource }}{{ .Contract.IconSource }}{{ else }}https://dummyimage.com/400x400/c4c4c4/ffffff.png&text=Logo{{ end }}" />
        </button>
        <input type="hidden" name="icon_source" id="icon_source" value="{{ .Contract.IconSource }}" />
    </div>
    <fieldset class="fieldset">
        <legend class="fieldset-legend">Name</legend>
        <input type="text" name="name" class="input w-full" value="{{ .Contract.Name }}" placeholder="Type here" />
    </fieldset>
    <fieldset class="fieldset">
        <legend class="fieldset-legend">Company</legend>
        <input type="text" name="company" class="input w-full" value="{{ .Contract.Company }}" placeholder="Type here" />
    </fieldset>
    <fieldset class="fieldset">
        <legend class="fieldset-legend">Category</legend>
        <select name="category" class="select w-full">
            <option {{ if or (not .Contract.Category) (eq .Contract.Category "") (eq .Contract.Category "Other") }}selected{{ end }}>Other</option>
            <option {{ if eq .Contract.Category "Education" }}selected{{ end }}>Education</option>
            <option {{ if eq .Contract.Category "Entertainment" }}selected{{ end }}>Entertainment</option>
            <option {{ if eq .Contract.Category "Finance" }}selected{{ end }}>Finance</option>
            <option {{ if eq .Contract.Category "Health & Fitness" }}selected{{ end }}>Health &amp; Fitness</option>
            <option {{ if eq .Contract.Category "Housing & Rent " }}selected{{ end }}>Housing &amp; Rent </option>
            <option {{ if eq .Contract.Category "Insurance" }}selected{{ end }}>Insurance</option>
            <option {{ if eq .Contract.Category "Software & Services" }}selected{{ end }}>Software &amp; Services</option>
            <option {{ if eq .Contract.Category "Telecommunications & Internet " }}selected{{ end }}>Telecommunications &amp; Internet </option>
            <option {{ if eq .Contract.Category "Transportation" }}selected{{ end }}>Transportation</option>
            <option {{ if eq .Contract.Category "Utilities" }}selected{{ end }}>Utilities</option>
        </select>
    </fieldset>
    <fieldset class="fieldset">
        <legend class="fieldset-legend">Costs</legend>
        <input type="number" name="costs" class="input w-full" value="{{ .Contract.Costs }}" placeholder="Type here" />
    </fieldset>
</div>
<div class="py-4 text-right">
    <button type="submit" class="btn btn-primary">{{ .SubmitLabel }}</button>
</div>
</form>

<script>
    // Klick auf Such-Resultat
    document.body.addEventListener('click', function(e) {
        if (!e.target.matches('#icon-results img')) return;
        document.querySelectorAll('#icon-results img.icon-selected')
            .forEach(img => img.classList.remove('icon-selected'));
        e.target.classList.add('icon-selected');
        document.getElementById('selected-icon-url').value = e.target.src;
    });
    // Apply-Button
    document.getElementById('apply-icon').addEventListener('click', function() {
        const url = document.getElementById('selected-icon-url').value;
        if (url) {
            document.getElementById('main-icon').src = url;
            document.getElementById('icon_source').value = url;
        }
        document.getElementById('my_modal_1').close();
    });
</script>

{{ end }}
